﻿@model Microflake.Core.ViewModel.ShoppingCartViewModel

@{
    float total = 0f;
}

<!--mini cart-->
@foreach (var item in Model.Items)
{
    if (item.Product.Qty > 0)
    {
        total += ((float)item.Product.SellPrice * item.Count);
    }
    bool outOfStock = false;

    if (item.Product.Qty < 1)
    {
        outOfStock = true;
    }

    if (item.FrontChip != null)
    {
        if (item.FrontChip.Qty < 1)
        {
            outOfStock = true;
        }
    }

    if (item.BackChip != null)
    {
        if (item.BackChip.Qty < 1)
        {
            outOfStock = true;
        }
    }

    if (item.FrontChip != null && item.BackChip != null)
    {
        if (item.FrontChip.Id == item.BackChip.Id && item.FrontChip.Qty < 2)
        {
            outOfStock = true;
        }
    }

    var rate = item.Product.SellPrice;

    <div class="cart_item">
        <div class="cart_img">
            <a href="#">
                <img src="@Config.Products@(item.Product.Image)" style="height:100px; width:100px;" onerror="this.src='/Public/default-image.jpg';">
            </a>
        </div>
        <div class="cart_info">
            <a href="#">@item.Product.Name</a>

            <span class="quantity">Qty:  @item.Count</span>
            <span class="price_cart">£ @rate</span>
            @if (item.Product.IsHasVariation == true)
            {
                if (item.BackChip != null)
                {
                    <img src="@Config.Products@(item.BackChip.Image)" style="height:50px; width:50px;display:inline-block">
                }

                if (item.FrontChip != null)
                {
                    <img src="@Config.Products@(item.FrontChip.Image)" style="height: 50px; width: 50px; display: inline-block">
                }
            }
            @if (outOfStock)
            {
                <div style="color: red;">Out Of Stock</div>
            }
        </div>
    </div>
}
<div class="cart_total">
    <span>Subtotal:</span>
    <span>£ @total</span>
</div>
<div class="mini_cart_footer">
    <div class="cart_button view_cart">
        <a href="/shop/CartItems">@Microflake.Web.Language.Language.ViewCart</a>
    </div>
    @if (total > 0)
    {
        <div class="cart_button checkout">
            <a class="active" href="/shop/Checkout">@Microflake.Web.Language.Language.Checkout</a>
        </div>
    }
</div>